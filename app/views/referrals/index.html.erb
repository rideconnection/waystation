<% title "Referrals" %>

<% if current_user.coach? %>
  <form id="search-form" class="search">
    <fieldset>
      <div class="title">Referrals created by:</div>
      <input type="radio" name="creator_type" value="inside" id="inside" <%= @query.creator_type == 'inside' ? 'checked = "checked"' : '' %>/>
      <label for="inside">Ride Connection users</label>
      <input type="radio" name="creator_type" value="outside" id="outside" <%= @query.creator_type == 'outside' ? 'checked = "checked"' : '' %>/>
      <label for="outside">Outside users</label>
      <input type="radio" name="creator_type" value="all" id="all_creators" <%= @query.creator_type == 'all' ? 'checked = "checked"' : '' %>/>
      <label for="all_creators">All</label>
      <br>
      <div class="title">Completion:</div>
      <input type="radio" name="completed" value="completed" id="completed" <%= @query.completed == 'completed' ? 'checked = "checked"' : '' %>/>
      <label for="completed">Completed</label>
      <input type="radio" name="completed" value="not_completed" id="not_completed" <%= @query.completed == 'not_completed' ? 'checked = "checked"' : '' %>/>
      <label for="not_completed">Not completed</label>
      <input type="radio" name="completed" value="all" id="all_complete_states" <%= @query.completed == 'all' ? 'checked = "checked"' : '' %>/>
      <label for="all_complete_states">All</label>
    </fieldset>
  </form>
<% end %>

<table>
  <tr>
    <th>Submitted</th>
    <th>Submitter</th>
    <th>Customer</th>
    <th>Case Manager</th>
    <th>Note</th>
    <th>Completed</th>
    <% if current_user.admin? %>
      <th>Active</th>
    <% end %>
    <th colspan="4" />
  </tr>
  <% for referral in @referrals %>
    <tr>
      <td><%= referral.created_at %></td>
      <td><%= referral.creator.try :username %></td>
      <td><%= referral.name %></td>
      <td><%= mail_to referral.case_manager_email, referral.case_manager_name %></td>
      <td><%= truncate referral.note %></td>
      <td><%= referral.completed ? 'Yes' : 'No' %></td>
      <% if current_user.admin? %>
        <td><%= referral.active ? 'Yes' : 'No' %></td>
      <% end %>
      <td><%= link_to("UCR Form", image_path(referral.ucr_form.url)) if referral.ucr_form.present? %></td>
      <td><%= link_to "Show", referral %></td>
      <td><%= link_to "Edit", edit_referral_path(referral) if can? :edit, referral %></td>
      <td><%= link_to "Destroy", referral, :confirm => 'Are you sure?', :method => :delete if can? :destroy, referral %></td>
    </tr>
  <% end %>
</table>

<p><%= link_to "New Referral", new_referral_path %></p>
